<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chapter 7 ‚Äî Solution Chemistry (Multi-Style Learning View)</title>
  <style>
    :root{
      --bg:#f6f7f9;
      --text:#1b1f24;
      --muted:#5b6672;
      --card:#ffffff;
      --border:#d9dee5;
      --shadow: 0 6px 18px rgba(17,24,39,.10);
      --shadow2: 0 2px 10px rgba(17,24,39,.08);
      --accent:#2563eb;
      --accent2:#0ea5e9;
      --danger:#ef4444;
      --ok:#10b981;
      --warn:#f59e0b;
      --codebg:#f3f5f7;
      --chip:#eef2ff;
    }
    body[data-theme="night"]{
      --bg:#171311;            /* warm dark */
      --text:#f2e9df;          /* warm off-white */
      --muted:#cbbfb3;
      --card:#221b17;
      --border:#3a2f28;
      --shadow: 0 10px 26px rgba(0,0,0,.38);
      --shadow2: 0 4px 14px rgba(0,0,0,.34);
      --accent:#7aa2ff;
      --accent2:#66d9ff;
      --danger:#ff6b6b;
      --ok:#4ade80;
      --warn:#fbbf24;
      --codebg:#1b1512;
      --chip:#2a231f;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background:var(--bg);
      color:var(--text);
      line-height:1.55;
    }

    /* Top toolbar */
    .topbar{
      position:sticky;
      top:0;
      z-index:50;
      background:var(--card);
      border-bottom:1px solid var(--border);
      box-shadow: var(--shadow2);
    }
    .topbar-inner{
      display:flex;
      gap:10px;
      align-items:center;
      padding:10px 12px;
      max-width:1200px;
      margin:0 auto;
    }
    .brand{
      display:flex;
      flex-direction:column;
      line-height:1.1;
      margin-right:auto;
      min-width: 220px;
    }
    .brand .title{
      font-weight:800;
      font-size:14px;
      letter-spacing:.2px;
    }
    .brand .subtitle{
      font-size:12px;
      color:var(--muted);
      margin-top:2px;
    }

    .seg{
      display:inline-flex;
      border:1px solid var(--border);
      border-radius:999px;
      overflow:hidden;
      background:transparent;
    }
    .seg button{
      border:0;
      background:transparent;
      color:var(--muted);
      padding:7px 10px;
      cursor:pointer;
      font-size:12px;
      font-weight:700;
      letter-spacing:.15px;
      min-width: 86px;
      transition: background .15s ease, color .15s ease;
    }
    .seg button.active{
      background:var(--chip);
      color:var(--text);
    }
    .iconbtn{
      border:1px solid var(--border);
      background:var(--card);
      color:var(--text);
      padding:7px 10px;
      border-radius:999px;
      cursor:pointer;
      font-weight:700;
      font-size:12px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition: transform .05s ease;
      user-select:none;
    }
    .iconbtn:active{ transform: translateY(1px); }
    .kbd{
      font-size:11px;
      color:var(--muted);
      border:1px solid var(--border);
      padding:1px 6px;
      border-radius:7px;
      background:transparent;
    }

    /* Layout */
    .shell{
      max-width:1200px;
      margin:0 auto;
      padding:12px;
    }
    .layout{
      display:grid;
      grid-template-columns: 310px 1fr;
      gap:12px;
      align-items:start;
    }
    body.sidebar-hidden .layout{
      grid-template-columns: 1fr;
    }

    /* Sidebar */
    .sidebar{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:var(--shadow2);
      overflow:hidden;
    }
    body.sidebar-hidden .sidebar{ display:none; }

    .sidebar-header{
      padding:12px 12px 10px;
      border-bottom:1px solid var(--border);
    }
    .search{
      width:100%;
      padding:10px 10px;
      border:1px solid var(--border);
      border-radius:12px;
      background:transparent;
      color:var(--text);
      outline:none;
      font-weight:600;
    }
    .search::placeholder{ color:var(--muted); font-weight:600; }

    .navlist{
      max-height: calc(100vh - 190px);
      overflow:auto;
      padding:10px;
    }
    .navitem{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding:10px 10px;
      border-radius:12px;
      cursor:pointer;
      border:1px solid transparent;
      user-select:none;
    }
    .navitem:hover{
      border-color: var(--border);
      background: rgba(127,127,127,.06);
    }
    .navitem.active{
      border-color: rgba(37,99,235,.35);
      background: rgba(37,99,235,.08);
    }
    .pill{
      font-size:11px;
      font-weight:900;
      padding:3px 8px;
      border-radius:999px;
      background:var(--chip);
      color:var(--text);
      border:1px solid var(--border);
      white-space:nowrap;
    }
    .navtext{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }
    .navtext .h{
      font-weight:850;
      font-size:12px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .navtext .d{
      font-size:12px;
      color:var(--muted);
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    /* Main */
    .main{
      min-width:0;
    }
    .panel{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:var(--shadow2);
      padding:14px;
    }

    /* Shared typography */
    h1,h2,h3{ margin:0 0 10px; }
    h2{
      font-size:18px;
      letter-spacing:.2px;
    }
    h3{
      font-size:14px;
      color:var(--muted);
      font-weight:800;
    }
    .section{
      border:1px solid var(--border);
      border-radius:16px;
      padding:14px;
      background:var(--card);
      box-shadow: var(--shadow2);
      margin:12px 0;
    }
    .section .sec-top{
      display:flex;
      align-items:flex-start;
      gap:10px;
      justify-content:space-between;
    }
    .section .sec-title{
      display:flex;
      flex-direction:column;
      gap:3px;
      min-width:0;
    }
    .section .sec-title .k{
      font-weight:900;
      font-size:14px;
      letter-spacing:.2px;
    }
    .section .sec-title .t{
      color:var(--muted);
      font-size:12px;
      font-weight:700;
    }
    .tools{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .mini{
      border:1px solid var(--border);
      background:transparent;
      color:var(--text);
      padding:6px 9px;
      border-radius:999px;
      cursor:pointer;
      font-weight:800;
      font-size:12px;
    }

    .callouts{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:10px;
    }
    .callout{
      border:1px solid var(--border);
      background: rgba(127,127,127,.06);
      border-radius:14px;
      padding:10px 12px;
    }
    .callout .tag{
      display:inline-flex;
      gap:8px;
      align-items:center;
      font-weight:900;
      font-size:12px;
      margin-bottom:6px;
    }
    .tag .dot{
      width:8px;height:8px;border-radius:99px;
      background:var(--accent);
      box-shadow: 0 0 0 2px rgba(127,127,127,.10);
    }
    .callout.tip .dot{ background:var(--ok); }
    .callout.pitfall .dot{ background:var(--warn); }
    .callout .body{
      font-size:13px;
      color:var(--text);
      font-weight:600;
    }

    .para{ font-size:13px; font-weight:600; }
    .muted{ color:var(--muted); }

    .formula{
      margin-top:10px;
      border:1px solid var(--border);
      border-radius:14px;
      overflow:hidden;
      background: var(--codebg);
    }
    .formula .row{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding:10px 10px;
      border-bottom:1px solid var(--border);
    }
    .formula .row:last-child{ border-bottom:0; }
    .formula code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12px;
      font-weight:700;
      white-space:pre-wrap;
    }
    .copybtn{
      margin-left:auto;
      border:1px solid var(--border);
      background:transparent;
      color:var(--text);
      padding:6px 9px;
      border-radius:10px;
      cursor:pointer;
      font-weight:900;
      font-size:12px;
    }

    /* Collapsibles */
    details{
      border:1px solid var(--border);
      border-radius:14px;
      background: rgba(127,127,127,.05);
      padding:10px 12px;
    }
    summary{
      cursor:pointer;
      font-weight:900;
      font-size:13px;
      list-style:none;
      display:flex;
      align-items:center;
      gap:10px;
      user-select:none;
    }
    summary::-webkit-details-marker{ display:none; }
    summary .caret{
      width:0;height:0;
      border-left:6px solid var(--muted);
      border-top:5px solid transparent;
      border-bottom:5px solid transparent;
      transform: rotate(0deg);
      transition: transform .12s ease;
    }
    details[open] summary .caret{ transform: rotate(90deg); }
    .node{
      margin-top:8px;
      padding-left:18px;
    }

    /* Book mode */
    .book .section{ scroll-margin-top: 76px; }

    /* PPT mode */
    .ppt-wrap{
      display:grid;
      gap:12px;
    }
    .deck{
      border:1px solid var(--border);
      border-radius:18px;
      overflow:hidden;
      background:var(--card);
      box-shadow:var(--shadow2);
    }
    .deck-head{
      padding:12px 14px;
      border-bottom:1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .deck-head .lh{
      display:flex;
      flex-direction:column;
      gap:3px;
      min-width:0;
    }
    .deck-head .lh .a{
      font-weight:950;
      font-size:13px;
      letter-spacing:.2px;
    }
    .deck-head .lh .b{
      font-size:12px;
      color:var(--muted);
      font-weight:700;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width: 620px;
    }
    .deck-controls{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .slide{
      padding:18px 16px 16px;
      min-height: 360px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .slide .stitle{
      font-size:22px;
      font-weight:950;
      letter-spacing:.2px;
    }
    .slide .smeta{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      color:var(--muted);
      font-weight:800;
      font-size:12px;
    }
    .slide .content{
      font-size:16px;
      font-weight:650;
    }
    .slide ul{ margin:8px 0 0 18px; }
    .slide li{ margin:6px 0; }
    .slide .block{
      border:1px solid var(--border);
      border-radius:14px;
      background: rgba(127,127,127,.06);
      padding:12px 12px;
      font-size:15px;
    }

    /* Map mode */
    .cards{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
    }
    .card{
      grid-column: span 12;
      border:1px solid var(--border);
      border-radius:18px;
      background:var(--card);
      box-shadow:var(--shadow2);
      overflow:hidden;
    }
    .card .chead{
      padding:12px 14px;
      border-bottom:1px solid var(--border);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .card .chead .x{
      display:flex; flex-direction:column; gap:2px; min-width:0;
    }
    .card .chead .x .k{ font-weight:950; font-size:13px; }
    .card .chead .x .t{ color:var(--muted); font-weight:750; font-size:12px; }
    .card .cbody{ padding:12px 14px 14px; display:grid; gap:10px; }

    /* Copy-on-double-click */
    .copyblock{ position:relative; }
    .copyhint{
      position:absolute;
      top:10px; right:10px;
      font-size:11px;
      color:var(--muted);
      border:1px solid var(--border);
      padding:2px 8px;
      border-radius:999px;
      background: rgba(127,127,127,.06);
      user-select:none;
    }

    /* Mobile */
    @media (max-width: 900px){
      .layout{ grid-template-columns: 1fr; }
      .sidebar{ order: 1; }
      .main{ order: 2; }
      body.sidebar-hidden .sidebar{ display:none; }
      .topbar-inner{ flex-wrap:wrap; }
      .brand{ min-width: 100%; margin-right:0; }
      .deck-head .lh .b{ max-width: 100%; }
      .slide{ min-height: 300px; }
    }
  </style>
</head>

<body data-theme="day">
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="title">Chapter 7 ‚Äî Solution Chemistry</div>
        <div class="subtitle">Book ‚Ä¢ PPT ‚Ä¢ Interactive Map + Day/Night themes</div>
      </div>

      <button class="iconbtn" id="sidebarToggle" title="Show/Hide sidebar">
        ‚ò∞ Sidebar <span class="kbd">S</span>
      </button>

      <div class="seg" role="tablist" aria-label="Mode Switch">
        <button id="modeBook" class="active" data-mode="book" role="tab">Book</button>
        <button id="modePpt" data-mode="ppt" role="tab">PPT</button>
        <button id="modeMap" data-mode="map" role="tab">Map</button>
      </div>

      <div class="seg" role="tablist" aria-label="Theme Switch">
        <button id="themeDay" class="active" data-theme="day" role="tab">Daylight</button>
        <button id="themeNight" data-theme="night" role="tab">Nightlight</button>
      </div>
    </div>
  </div>

  <div class="shell">
    <div class="layout">
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <input id="search" class="search" type="text" placeholder="Search sections (e.g., dilution, micelle, titration)..." />
        </div>
        <div class="navlist" id="navlist"></div>
      </aside>

      <main class="main">
        <div class="panel copyblock" id="modeContainer">
          <div class="copyhint" title="Tip">Double-click any text block to copy</div>
          <div id="view"></div>
        </div>
      </main>
    </div>
  </div>

  <script>
    // -----------------------------
    // Content model (single source of truth)
    // -----------------------------
    const SECTIONS = [
      {
        id: "7.1",
        title: "Solutions and Solubility",
        book: {
          keyIdeas: [
            "A solution is a homogeneous mixture: solute (dissolved) + solvent (does the dissolving).",
            "Homogeneous looks uniform; heterogeneous has visibly different parts/phases.",
            "Miscible liquids mix completely; immiscible liquids form layers."
          ],
          formulas: [],
          explanations: [
            {
              label: "Solubility (and saturation states)",
              text:
                "Solubility means how much solute can dissolve in a given amount of solvent at a given temperature. " +
                "If more solute can still dissolve, the solution is unsaturated. If it has reached the maximum, it is saturated. " +
                "A supersaturated solution contains more dissolved solute than would normally be possible at that temperature, so it is unstable and can crystallize suddenly."
            },
            {
              label: "Why temperature matters",
              text:
                "Temperature changes particle motion and the balance between dissolving and recrystallizing. " +
                "Many salts become more soluble in hot water, but some behave differently, so you must read the solubility curve."
            }
          ],
          examples: [
            "If a salt is much more soluble at high temperature, you can dissolve a lot in hot water, then cool it. Crystals may form because the cooler water can‚Äôt hold as much dissolved solute."
          ],
          callouts: [
            { type:"tip", title:"Supersaturated = unstable", body:"A supersaturated solution can look normal until a disturbance triggers rapid crystallization." }
          ]
        },
        map: {
          roots: [
            "Solution = homogeneous mixture (solute + solvent).",
            "Homogeneous vs heterogeneous; miscible vs immiscible."
          ],
          trunk: [
            "Solubility depends on temperature; solubility curves summarize the pattern.",
            "Unsaturated / saturated / supersaturated (extra dissolved solute; unstable)."
          ],
          leaves: [
            "Cooling a concentrated hot solution can cause crystals to form (solubility drops)."
          ]
        },
        ppt: [
          {
            name:"Big idea / overview",
            bullets:[
              "Solutions are homogeneous mixtures (uniform throughout).",
              "Solubility tells you the maximum amount that can dissolve at a specific temperature."
            ]
          },
          {
            name:"Key terms",
            bullets:[
              "Solute vs solvent",
              "Homogeneous vs heterogeneous",
              "Miscible vs immiscible",
              "Unsaturated / saturated / supersaturated"
            ]
          },
          {
            name:"Rules & patterns",
            bullets:[
              "Temperature often increases solubility for many salts (but not always).",
              "Supersaturated solutions are unstable and may crystallize suddenly."
            ]
          },
          {
            name:"Example / interpretation",
            bullets:[
              "A hot saturated solution may form crystals when cooled because solubility decreases."
            ]
          }
        ]
      },

      {
        id: "7.2",
        title: "Intermolecular Forces and ‚ÄúLike Dissolves Like‚Äù",
        book: {
          keyIdeas: [
            "Dissolving works when solute‚Äìsolvent attractions can replace solute‚Äìsolute and solvent‚Äìsolvent attractions.",
            "‚ÄúLike dissolves like‚Äù: polar/ionic dissolves in polar; non-polar dissolves in non-polar.",
            "Some molecules have both polar and non-polar parts (important for detergents/soap)."
          ],
          formulas: [],
          explanations: [
            {
              label: "Like dissolves like (meaning)",
              text:
                "This rule is a shortcut: a solvent dissolves a solute best when their intermolecular forces are similar. " +
                "If the solvent can form strong interactions with the solute (ion‚Äìdipole, dipole‚Äìdipole, hydrogen bonding), the solute can separate and mix evenly."
            },
            {
              label: "Soap as an emulsifying agent",
              text:
                "Soap ions have a polar/charged head (often ‚ÄìCOO‚Åª) that interacts with water, and a non-polar hydrocarbon tail that dissolves oils/grease. " +
                "Because they connect polar water with non-polar oil, soaps help immiscible liquids become suspended together (emulsification)."
            },
            {
              label: "Micelles (how soap removes grease)",
              text:
                "Soap molecules form micelles: hydrophilic heads face outward into water, hydrophobic tails point inward, trapping oil/grease in the center. " +
                "Rinsing removes the micelle because the outside interacts well with water."
            }
          ],
          examples: [
            "A stain that dissolves in water but not in a non-polar solvent is likely polar/ionic, because water can form strong interactions while the non-polar solvent cannot."
          ],
          callouts: [
            { type:"pitfall", title:"Not everything is purely polar or non-polar", body:"Some molecules have both regions (like ethanol), so their solubility can be ‚Äúin between.‚Äù" }
          ]
        },
        map: {
          roots: [
            "Dissolving depends on intermolecular forces (IMFs).",
            "Like dissolves like (polar/ionic ‚Üî polar; non-polar ‚Üî non-polar)."
          ],
          trunk: [
            "Soap: polar/charged head + non-polar tail = emulsifier.",
            "Micelles: heads out, tails in, grease trapped in center."
          ],
          leaves: [
            "Why some stains dissolve in water but not in non-polar dry-cleaning solvent."
          ]
        },
        ppt: [
          {
            name:"Big idea / overview",
            bullets:[
              "Solubility is controlled by intermolecular forces (IMFs).",
              "A solvent dissolves a solute when it can form strong enough solute‚Äìsolvent attractions."
            ]
          },
          {
            name:"Key terms",
            bullets:[
              "Polar vs non-polar",
              "Hydrophilic vs hydrophobic",
              "Emulsifier",
              "Micelle"
            ]
          },
          {
            name:"Rules & patterns",
            bullets:[
              "Like dissolves like.",
              "Soap bridges polar water and non-polar oil."
            ]
          },
          {
            name:"Example / interpretation",
            bullets:[
              "Micelles trap grease so water can rinse it away."
            ]
          }
        ]
      },

      {
        id: "7.3",
        title: "Dissociation Equations and Solution Conductivity",
        book: {
          keyIdeas: [
            "Molarity measures concentration: moles of solute per litre of solution.",
            "Dilution decreases concentration because volume increases while moles stay the same.",
            "Electrical conductivity in solution comes from mobile ions: more ions ‚Üí higher conductivity.",
            "Ionic solutes and strong acids tend to form many ions (strong electrolytes); covalent solutes usually do not (nonelectrolytes)."
          ],
          formulas: [
            {
              name: "Molarity (molar concentration)",
              expr: "[solute] = moles of solute / litres of solution",
              meaning:
                "This tells you how many moles are dissolved in each litre. Units are mol/L (M). Brackets [ ] mean molar concentration."
            }
          ],
          explanations: [
            {
              label: "Dilution (the core idea)",
              text:
                "When you dilute, you add solvent. The amount (moles) of solute does not change, but the total volume increases. " +
                "So concentration decreases. The opposite (more concentrated) can be made by removing solvent (evaporation) or adding more solute."
            },
            {
              label: "Worked example: dilution",
              text:
                "15.0 mL of 3.0 M HCl is diluted by adding 10.0 mL water. " +
                "Moles HCl initially: 3.0 mol/L √ó 0.0150 L = 0.045 mol. " +
                "New volume: 25.0 mL = 0.0250 L. " +
                "New [HCl] = 0.045 mol / 0.0250 L = 1.8 M. " +
                "This makes sense because volume increased, so concentration dropped."
            },
            {
              label: "Conductivity & electrolytes",
              text:
                "Electric current in solution is carried by ions. More ions means higher conductivity. " +
                "Soluble salts usually produce many ions (high conductivity). Low-solubility salts produce fewer ions (lower conductivity). " +
                "Covalent compounds generally do not form ions (no conductivity), with some acid/base exceptions."
            },
            {
              label: "Strong vs weak electrolytes (why)",
              text:
                "Strong acids dissociate completely to form ions (strong electrolytes). Weak acids and bases produce only a few ions (weak electrolytes)."
            }
          ],
          examples: [
            "A strong acid solution usually conducts better than a weak acid solution of the same molarity because it creates far more ions."
          ],
          callouts: [
            { type:"tip", title:"Sense check your dilution answers", body:"If you add water, the concentration must go down. If your answer goes up, something is wrong." }
          ]
        },
        map: {
          roots: [
            "Molarity: moles per litre (mol/L).",
            "Brackets [ ] mean molar concentration."
          ],
          trunk: [
            "Dilution: moles stay the same, volume increases, concentration decreases.",
            "Dissociation equations show what ions form in water."
          ],
          leaves: [
            "Conductivity depends on total mobile ion concentration: more ions ‚Üí brighter bulb.",
            "Strong acids dissociate completely; weak acids/bases only partially."
          ]
        },
        ppt: [
          {
            name:"Big idea / overview",
            bullets:[
              "Concentration tells ‚Äúhow much solute per volume.‚Äù",
              "Conductivity tells ‚Äúhow many mobile ions are present.‚Äù"
            ]
          },
          {
            name:"Definitions (key terms)",
            bullets:[
              "Molarity (mol/L)",
              "Dilution",
              "Dissociation equation",
              "Electrolyte vs nonelectrolyte"
            ]
          },
          {
            name:"Formulas + meanings",
            bullets:[
              "[solute] = moles / litres (units: mol/L)",
              "Dilution idea: moles stay constant when only water is added"
            ],
            blocks:[
              "[solute] = moles of solute / litres of solution"
            ]
          },
          {
            name:"Example / interpretation",
            bullets:[
              "3.0 M HCl diluted from 15.0 mL to 25.0 mL becomes 1.8 M (moles unchanged, volume increased)."
            ]
          }
        ]
      },

      {
        id: "7.4",
        title: "Titrations (Intro + Practical Aspects)",
        book: {
          keyIdeas: [
            "Titration is a quantitative method to find an unknown concentration by reacting it with a known (standardized) solution.",
            "Equivalence point (chemical completion) is matched to an observable endpoint (indicator colour change).",
            "Accurate glassware + correct significant figures matter a lot in titrations."
          ],
          formulas: [
            {
              name: "Core titration pattern",
              expr: "moles = M √ó V(L)  ‚Üí  use mole ratio  ‚Üí  [unknown] = moles unknown / Vunknown(L)",
              meaning:
                "You calculate moles of the known solution from molarity and volume, use the balanced equation to convert to moles of the unknown, then divide by the unknown‚Äôs volume to get its concentration."
            }
          ],
          explanations: [
            {
              label: "Standardized solution",
              text:
                "The solution with known concentration is the standardized solution. The other solution has unknown concentration."
            },
            {
              label: "Equivalence point vs endpoint",
              text:
                "The equivalence point occurs when the reacting amounts match the balanced equation. In simple acid‚Äìbase titrations, it‚Äôs when moles of H+ equal moles of OH‚àí. " +
                "The endpoint is when the indicator changes colour (what you observe and record)."
            },
            {
              label: "Glassware roles (why each matters)",
              text:
                "Burette holds the standardized solution and lets you measure volume delivered by initial‚Äìfinal readings. " +
                "Pipette delivers a precise volume of the unknown solution into the flask (use a bulb‚Äînever mouth suction). " +
                "The Erlenmeyer flask holds the unknown + indicator and is where the reaction occurs."
            },
            {
              label: "Worked example: finding [HCl]",
              text:
                "10.00 mL of HCl reacts completely with 18.25 mL of 0.100 M NaOH. " +
                "Balanced equation is 1:1. Moles NaOH = 0.100 √ó 0.01825 = 0.001825 mol, so moles HCl = 0.001825 mol. " +
                "[HCl] = 0.001825 mol / 0.01000 L = 0.1825 M (then round based on sig figs)."
            },
            {
              label: "Indicator example (phenolphthalein)",
              text:
                "Phenolphthalein is colourless in acid and pink in base. During titration, the solution stays colourless while acid is in excess, and turns pink once base becomes excess‚Äîoften within one drop."
            }
          ],
          examples: [
            "If the indicator turns pink and stays pink after swirling, you‚Äôve likely reached (or slightly passed) the endpoint‚Äîstop and record the final burette reading."
          ],
          callouts: [
            { type:"pitfall", title:"Endpoint ‚â† equivalence point (but should be close)", body:"The indicator colour change is an approximation of the true equivalence point." }
          ]
        },
        map: {
          roots: [
            "Standardized solution = known concentration; unknown solution is being measured.",
            "Equivalence point: moles H+ = moles OH‚àí (simple acid‚Äìbase)."
          ],
          trunk: [
            "Titration math pattern: M√óV ‚Üí moles ‚Üí mole ratio ‚Üí concentration.",
            "Glassware precision controls final accuracy (burette, pipette, flask)."
          ],
          leaves: [
            "Indicator endpoint: phenolphthalein colourless ‚Üí pink when base is in excess."
          ]
        },
        ppt: [
          {
            name:"Big idea / overview",
            bullets:[
              "Titration finds an unknown concentration using a known (standardized) solution.",
              "You connect measured volumes to moles using molarity and stoichiometry."
            ]
          },
          {
            name:"Definitions (key terms)",
            bullets:[
              "Standardized solution",
              "Equivalence point",
              "Endpoint",
              "Indicator"
            ]
          },
          {
            name:"Formulas + symbol meanings",
            bullets:[
              "moles = M √ó V(L)",
              "[unknown] = moles unknown / Vunknown(L)"
            ],
            blocks:[
              "moles = M √ó V(L)",
              "[unknown] = moles unknown / Vunknown(L)"
            ]
          },
          {
            name:"Example / interpretation",
            bullets:[
              "10.00 mL HCl titrated with 18.25 mL of 0.100 M NaOH ‚Üí [HCl] ‚âà 0.1825 M (1:1 reaction).",
              "Phenolphthalein: colourless in acid; pink when base is in excess."
            ]
          }
        ]
      }
    ];

    // -----------------------------
    // State + persistence
    // -----------------------------
    const STORAGE = {
      theme: "sc_theme",
      mode: "sc_mode",
      sidebar: "sc_sidebar"
    };

    const state = {
      theme: "day",
      mode: "book",
      sidebarHidden: false,
      query: "",
      activeId: "7.1",
      ppt: { deckId: "7.1", slideIndex: 0 }
    };

    function loadPrefs(){
      const t = localStorage.getItem(STORAGE.theme);
      const m = localStorage.getItem(STORAGE.mode);
      const s = localStorage.getItem(STORAGE.sidebar);
      if(t === "day" || t === "night") state.theme = t;
      if(m === "book" || m === "ppt" || m === "map") state.mode = m;
      if(s === "hidden" || s === "shown") state.sidebarHidden = (s === "hidden");
    }
    function savePrefs(){
      localStorage.setItem(STORAGE.theme, state.theme);
      localStorage.setItem(STORAGE.mode, state.mode);
      localStorage.setItem(STORAGE.sidebar, state.sidebarHidden ? "hidden" : "shown");
    }

    // -----------------------------
    // Utilities
    // -----------------------------
    const $ = (sel) => document.querySelector(sel);

    function toast(msg){
      const t = document.createElement("div");
      t.textContent = msg;
      t.style.position="fixed";
      t.style.left="50%";
      t.style.bottom="18px";
      t.style.transform="translateX(-50%)";
      t.style.background="rgba(0,0,0,.70)";
      t.style.color="#fff";
      t.style.padding="10px 12px";
      t.style.borderRadius="999px";
      t.style.fontWeight="800";
      t.style.fontSize="12px";
      t.style.zIndex="999";
      t.style.maxWidth="92vw";
      t.style.textAlign="center";
      document.body.appendChild(t);
      setTimeout(()=>{ t.remove(); }, 1200);
    }

    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        toast("Copied to clipboard");
      }catch(e){
        toast("Copy failed (browser permissions)");
      }
    }

    function sectionMatches(sec, q){
      if(!q) return true;
      const hay = JSON.stringify(sec).toLowerCase();
      return hay.includes(q.toLowerCase());
    }

    function setActive(id){
      state.activeId = id;
      // keep ppt deck aligned if currently in ppt mode
      if(state.mode === "ppt"){
        state.ppt.deckId = id;
        state.ppt.slideIndex = 0;
      }
      renderNav();
      renderView();
    }

    // -----------------------------
    // Rendering: Sidebar
    // -----------------------------
    function renderNav(){
      const nav = $("#navlist");
      nav.innerHTML = "";
      const filtered = SECTIONS.filter(s => sectionMatches(s, state.query));

      filtered.forEach(sec=>{
        const div = document.createElement("div");
        div.className = "navitem" + (sec.id === state.activeId ? " active" : "");
        div.innerHTML = `
          <span class="pill">${sec.id}</span>
          <div class="navtext">
            <div class="h">${sec.title}</div>
            <div class="d">${sec.book.keyIdeas[0] || ""}</div>
          </div>
        `;
        div.addEventListener("click", ()=>{
          setActive(sec.id);
          // In book/map mode, scroll to section after render
          if(state.mode !== "ppt"){
            setTimeout(()=>{
              const el = document.getElementById("sec-"+sec.id);
              if(el) el.scrollIntoView({behavior:"smooth", block:"start"});
            }, 30);
          }
        });
        nav.appendChild(div);
      });

      if(filtered.length === 0){
        const empty = document.createElement("div");
        empty.style.padding="12px";
        empty.style.color="var(--muted)";
        empty.style.fontWeight="800";
        empty.textContent = "No matches. Try a different keyword.";
        nav.appendChild(empty);
      }
    }

    // -----------------------------
    // Rendering: Book View
    // -----------------------------
    function renderBook(){
      const filtered = SECTIONS.filter(s => sectionMatches(s, state.query));

      const wrap = document.createElement("div");
      wrap.className = "book";

      filtered.forEach(sec=>{
        const box = document.createElement("div");
        box.className = "section";
        box.id = "sec-"+sec.id;

        box.innerHTML = `
          <div class="sec-top">
            <div class="sec-title">
              <div class="k">${sec.id} ‚Äî ${sec.title}</div>
              <div class="t">Book View: full explanations (double-click to copy blocks)</div>
            </div>
            <div class="tools">
              <button class="mini" data-jump="${sec.id}">Focus</button>
            </div>
          </div>

          <div class="callouts">
            <div class="callout">
              <div class="tag"><span class="dot"></span>Key ideas</div>
              <div class="body para copyblock" data-copy="${escapeAttr(sec.book.keyIdeas.join("\n‚Ä¢ "))}">
                <ul>${sec.book.keyIdeas.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>
              </div>
            </div>

            ${sec.book.explanations.map(ex=>`
              <div class="callout">
                <div class="tag"><span class="dot"></span>${escapeHtml(ex.label)}</div>
                <div class="body para copyblock" data-copy="${escapeAttr(ex.text)}">${escapeHtml(ex.text)}</div>
              </div>
            `).join("")}

            ${sec.book.formulas.length ? `
              <div class="callout">
                <div class="tag"><span class="dot"></span>Important formulas & meanings</div>
                <div class="body">
                  ${sec.book.formulas.map(f=>`
                    <div class="formula">
                      <div class="row">
                        <div style="min-width:0;">
                          <div style="font-weight:950; font-size:12px; margin-bottom:6px;">${escapeHtml(f.name)}</div>
                          <code class="copyblock" data-copy="${escapeAttr(f.expr)}">${escapeHtml(f.expr)}</code>
                        </div>
                        <button class="copybtn" data-copybtn="${escapeAttr(f.expr)}">üìã Copy</button>
                      </div>
                      <div class="row">
                        <div class="para copyblock" data-copy="${escapeAttr(f.meaning)}">${escapeHtml(f.meaning)}</div>
                      </div>
                    </div>
                  `).join("")}
                </div>
              </div>
            ` : ""}

            ${sec.book.examples.length ? `
              <div class="callout tip">
                <div class="tag"><span class="dot"></span>Short example(s) / interpretation</div>
                <div class="body para copyblock" data-copy="${escapeAttr(sec.book.examples.join("\n"))}">
                  <ul>${sec.book.examples.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>
                </div>
              </div>
            ` : ""}

            ${(sec.book.callouts || []).map(c=>`
              <div class="callout ${c.type || ""}">
                <div class="tag"><span class="dot"></span>${escapeHtml(c.title)}</div>
                <div class="body para copyblock" data-copy="${escapeAttr(c.body)}">${escapeHtml(c.body)}</div>
              </div>
            `).join("")}
          </div>
        `;

        wrap.appendChild(box);
      });

      return wrap;
    }

    // -----------------------------
    // Rendering: Map View
    // -----------------------------
    function renderMap(){
      const filtered = SECTIONS.filter(s => sectionMatches(s, state.query));

      const wrap = document.createElement("div");
      wrap.className = "cards";

      filtered.forEach(sec=>{
        const card = document.createElement("div");
        card.className = "card";
        card.id = "sec-"+sec.id;

        card.innerHTML = `
          <div class="chead">
            <div class="x">
              <div class="k">${sec.id} ‚Äî ${sec.title}</div>
              <div class="t">Interactive Map: Roots ‚Üí Trunk ‚Üí Leaves</div>
            </div>
            <div class="tools">
              <button class="mini" data-mapcopy="${sec.id}">üìã Copy card</button>
            </div>
          </div>
          <div class="cbody">
            <details open>
              <summary><span class="caret"></span>Roots (core ideas & definitions)</summary>
              <div class="node copyblock" data-copy="${escapeAttr(sec.map.roots.join("\n‚Ä¢ "))}">
                <ul>${sec.map.roots.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>
              </div>
            </details>

            <details>
              <summary><span class="caret"></span>Trunk (formulas, rules, patterns)</summary>
              <div class="node copyblock" data-copy="${escapeAttr(sec.map.trunk.join("\n‚Ä¢ "))}">
                <ul>${sec.map.trunk.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>
              </div>
            </details>

            <details>
              <summary><span class="caret"></span>Leaves (examples, tips, interpretations)</summary>
              <div class="node copyblock" data-copy="${escapeAttr(sec.map.leaves.join("\n‚Ä¢ "))}">
                <ul>${sec.map.leaves.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>
              </div>
            </details>
          </div>
        `;
        wrap.appendChild(card);
      });

      return wrap;
    }

    // -----------------------------
    // Rendering: PPT View
    // -----------------------------
    function renderPpt(){
      const filtered = SECTIONS.filter(s => sectionMatches(s, state.query));

      // ensure deckId exists in filtered
      if(!filtered.some(s=>s.id === state.ppt.deckId)){
        state.ppt.deckId = filtered[0]?.id || SECTIONS[0].id;
        state.ppt.slideIndex = 0;
      }
      const sec = SECTIONS.find(s=>s.id === state.ppt.deckId) || SECTIONS[0];
      const slides = makeSlidesFor(sec);

      // clamp slide index
      state.ppt.slideIndex = Math.max(0, Math.min(state.ppt.slideIndex, slides.length-1));
      const slide = slides[state.ppt.slideIndex];

      const wrap = document.createElement("div");
      wrap.className = "ppt-wrap";

      const deck = document.createElement("div");
      deck.className = "deck";
      deck.innerHTML = `
        <div class="deck-head">
          <div class="lh">
            <div class="a">${sec.id} ‚Äî ${sec.title}</div>
            <div class="b">PPT View: ‚Üê / ‚Üí to navigate slides ‚Ä¢ Deck changes when you pick a section in the sidebar</div>
          </div>
          <div class="deck-controls">
            <button class="iconbtn" id="prevSlide">‚Üê Prev</button>
            <div class="kbd">${state.ppt.slideIndex+1} / ${slides.length}</div>
            <button class="iconbtn" id="nextSlide">Next ‚Üí</button>
          </div>
        </div>
        <div class="slide" id="slide">
          <div class="stitle copyblock" data-copy="${escapeAttr(slide.title)}">${escapeHtml(slide.title)}</div>
          <div class="smeta">
            <span class="pill">${sec.id}</span>
            <span class="pill">${escapeHtml(slide.kind)}</span>
            <span class="muted">Tip: double-click to copy any block</span>
          </div>

          <div class="content">
            ${slide.bullets?.length ? `
              <ul class="copyblock" data-copy="${escapeAttr(slide.bullets.join("\n‚Ä¢ "))}">
                ${slide.bullets.map(b=>`<li>${escapeHtml(b)}</li>`).join("")}
              </ul>
            ` : ""}

            ${slide.blocks?.length ? slide.blocks.map(txt=>`
              <div class="block">
                <div style="display:flex; gap:10px; align-items:flex-start;">
                  <code class="copyblock" data-copy="${escapeAttr(txt)}" style="white-space:pre-wrap; font-weight:800;">${escapeHtml(txt)}</code>
                  <button class="copybtn" data-copybtn="${escapeAttr(txt)}">üìã Copy</button>
                </div>
              </div>
            `).join("") : ""}

            ${slide.paragraph ? `
              <div class="block para copyblock" data-copy="${escapeAttr(slide.paragraph)}">${escapeHtml(slide.paragraph)}</div>
            ` : ""}
          </div>
        </div>
      `;

      wrap.appendChild(deck);

      // Bind buttons after insertion
      setTimeout(()=>{
        $("#prevSlide")?.addEventListener("click", ()=>{ goSlide(-1, slides.length); });
        $("#nextSlide")?.addEventListener("click", ()=>{ goSlide(+1, slides.length); });
      }, 0);

      return wrap;

      function goSlide(delta, n){
        state.ppt.slideIndex = (state.ppt.slideIndex + delta + n) % n;
        renderView();
      }
    }

    function makeSlidesFor(sec){
      // Build slides in a consistent pattern:
      // 1) Big idea 2) Definitions 3) Formulas 4) Example/interpretation
      const ppt = sec.ppt || [];
      const slides = [];
      // If content already structured, convert:
      ppt.forEach((p,i)=>{
        slides.push({
          kind: p.name || `Slide ${i+1}`,
          title: (p.name || `Slide ${i+1}`),
          bullets: p.bullets || [],
          blocks: p.blocks || []
        });
      });

      // Ensure at least one explanation slide for book content
      if(!slides.length){
        slides.push({
          kind: "Overview",
          title: "Big idea / overview",
          bullets: sec.book.keyIdeas
        });
      }

      // Add an explanation slide if helpful
      if(sec.book.explanations?.length){
        slides.push({
          kind:"Why this works",
          title:"Concept focus (WHY)",
          paragraph: sec.book.explanations[0].text
        });
      }

      return slides;
    }

    // -----------------------------
    // Main render
    // -----------------------------
    function renderView(){
      document.body.setAttribute("data-theme", state.theme);
      document.body.classList.toggle("sidebar-hidden", state.sidebarHidden);

      // Mode button states
      ["book","ppt","map"].forEach(m=>{
        const btn = document.querySelector(`[data-mode="${m}"]`);
        if(btn) btn.classList.toggle("active", state.mode === m);
      });
      ["day","night"].forEach(t=>{
        const btn = document.querySelector(`[data-theme="${t}"]`);
        if(btn) btn.classList.toggle("active", state.theme === t);
      });

      const view = $("#view");
      view.innerHTML = "";

      if(state.mode === "book") view.appendChild(renderBook());
      if(state.mode === "ppt") view.appendChild(renderPpt());
      if(state.mode === "map") view.appendChild(renderMap());

      wireCopyButtons();
      savePrefs();
    }

    function wireCopyButtons(){
      // Copy buttons
      document.querySelectorAll("[data-copybtn]").forEach(btn=>{
        btn.addEventListener("click", (e)=>{
          const txt = btn.getAttribute("data-copybtn") || "";
          copyText(txt);
          e.stopPropagation();
        });
      });

      // Double-click copy: any element with .copyblock and data-copy OR textContent
      document.querySelectorAll(".copyblock").forEach(el=>{
        el.addEventListener("dblclick", (e)=>{
          const txt = el.getAttribute("data-copy") || el.textContent || "";
          copyText(txt.trim());
          e.stopPropagation();
        });
      });

      // Map: copy whole card
      document.querySelectorAll("[data-mapcopy]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-mapcopy");
          const sec = SECTIONS.find(s=>s.id === id);
          if(!sec) return;
          const txt =
            `${sec.id} ‚Äî ${sec.title}\n\n` +
            `Roots:\n- ${sec.map.roots.join("\n- ")}\n\n` +
            `Trunk:\n- ${sec.map.trunk.join("\n- ")}\n\n` +
            `Leaves:\n- ${sec.map.leaves.join("\n- ")}`;
          copyText(txt);
        });
      });

      // Book: focus button
      document.querySelectorAll("[data-jump]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-jump");
          state.activeId = id;
          renderNav();
          toast(`Focused: ${id}`);
        });
      });
    }

    // -----------------------------
    // Events: toolbar + search + keyboard
    // -----------------------------
    function bindUI(){
      // Mode switch
      document.querySelectorAll("[data-mode]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          state.mode = btn.getAttribute("data-mode");
          // align active section to ppt deck if switching into ppt
          if(state.mode === "ppt"){
            state.ppt.deckId = state.activeId;
            state.ppt.slideIndex = 0;
          }
          renderView();
        });
      });

      // Theme switch
      document.querySelectorAll("[data-theme]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          state.theme = btn.getAttribute("data-theme");
          renderView();
        });
      });

      // Sidebar toggle
      $("#sidebarToggle").addEventListener("click", ()=>{
        state.sidebarHidden = !state.sidebarHidden;
        renderView();
        renderNav();
      });

      // Search
      $("#search").addEventListener("input", (e)=>{
        state.query = e.target.value.trim();
        renderNav();
        renderView();
      });

      // Keyboard shortcuts
      window.addEventListener("keydown", (e)=>{
        // Ignore typing in inputs
        const tag = (document.activeElement?.tagName || "").toLowerCase();
        if(tag === "input" || tag === "textarea") return;

        if(e.key.toLowerCase() === "s"){
          state.sidebarHidden = !state.sidebarHidden;
          renderView();
          renderNav();
          e.preventDefault();
        }
        if(state.mode === "ppt"){
          if(e.key === "ArrowRight"){
            state.ppt.slideIndex++;
            renderView();
            e.preventDefault();
          }
          if(e.key === "ArrowLeft"){
            state.ppt.slideIndex--;
            renderView();
            e.preventDefault();
          }
        }
      });
    }

    // -----------------------------
    // Helpers: safe HTML
    // -----------------------------
    function escapeHtml(str){
      return (str ?? "").replace(/[&<>"']/g, s => ({
        "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#39;"
      }[s]));
    }
    function escapeAttr(str){
      // keep it simple: escape quotes and ampersands for attribute use
      return (str ?? "").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
    }

    // -----------------------------
    // Boot
    // -----------------------------
    loadPrefs();
    bindUI();
    renderNav();
    renderView();
  </script>
</body>
</html>

